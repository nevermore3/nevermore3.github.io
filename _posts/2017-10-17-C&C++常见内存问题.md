## C&C++ 代码编写规范

----------
### 常见的内存越界问题和解决措施建议  
**Q:数组分配未考虑最大情况，导致空间不够**  
> A：数组的大小要考虑最大的情况，避免数组分配空间不足  

**使用危险函数printf /vsprintf/strcpy/strcat/gets操作字符串**
> A：使用相对安全的字符串库函数 snprintf/strncpy/strncat/fgets操作字符串  

**字符串没有考虑最后的‘\0’**  
> A:计算长度加1

**指针加减操作时候，没有考虑指针类型**
> A: 将指针作为无结构的内存块进行操作，先将其转换为char * 类型

**魔鬼数字： 人工计算字符串长度出错**
> A:调用函数来计算，不要手工计算

**魔鬼数字：人工计算结构长度出错**
> A:调用sizeof计算，不要手工计算

**未考虑结构类型，内存分配不够**
> A:调用sizeof计算， 不要手工计算

**数组下标未检查导致越界**
>A:对于外部输入的数组下标要做检查  

**使用了相似名子的宏定义/结构名称**
>A:注意相似的宏定义/结构,copy/paste特别小心

**变量没有初始化**
>A:总是初始化变量：在首次使用前声明、定义、初始化。

**没有校验外部输入参数**
>A:在外部接口处，检查所有的输入数据

**字节对齐出错**
>A:头文件的声明应该统一规划，一个文件里面不要有多种字节对齐方式

**编译开关不一致**
>A:应尽量减少或合并编译开关

**错误使用sizeof**
>A:在函数原型定义时，就应写作正确的指针类型。

--------

- 内存使用必须遵循谁申请谁释放原则
- 内存释放函数和该内存的申请函数必须配套使用
- **申请内存后必须要先判断内存有效性**
- 内存拷贝前必须进行有效性判断，避免内存越界
- 禁止引用已经释放的内存空间
- 指针使用前必须进行有效性判断，避免使用空指针
- 指针内存释放后，对应指针必须置空
- 释放结构体/数组/各类数据容器指针前，必须先释放成员指针
- 严禁使用未经初始化的变量作为右值
- 使用循环变量必须初始化，防止出现随机数，导致死循环
- 用宏对表达式进行定义时，最外层必须使用括号
- 当为字符串分配空间、字符串复制时，一定要给结尾标志字符‘\0’留出空间
- 字符串操作时候，字符串长度申请要加1
- 字符串拷贝时，一定要注意目标字符串的长度是否足够
- 数组使用前必须进行数组下标合法性判断
- 数组分配考虑最大情况，避免导致空间不够
- 当声明用于分布式环境或不同CPU间通信环境的数据结构时，必须考虑机器的字节顺序、使用的位域和字节对齐问题
- 类型强制转换要防止越界
- 运算符使用必须加括号进行保护，禁止使用默认优先级
- 对加、减、乘等运算要进行溢出保护
- 除法运算，必须要对除零操作有效保护
- 对函数传入参数必须进行有效性的检查
- 禁止返回函数中定义的局部指针变量
- 类中申请的成员内存，在类析构前必须释放
- 多线程编程，对于线程安全的变量、函数、资源、必须加锁保护，避免出现访问异常
